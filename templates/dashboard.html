{% extends "base.html" %}

{% block title %}Dashboard | HandSignify{% endblock %}

{% block content %}
<main class="auth-container">
    <div class="dashboard-container">
        <h1>Real-Time Detection</h1>
        <p class="text-muted mb-4">Ensure your camera is enabled and you are well-lit for best results.</p>

        <div class="controls mb-3">
            <button id="startCameraButton" class="btn-primary">Start Camera</button>
            <button id="closeCameraButton" class="btn-danger-custom hidden"
                style="background-color: #ef4444; border:none; padding: 0.8rem 1.8rem; border-radius: var(--radius-sm); color: white; cursor: pointer; transition: all 0.3s;">Stop
                Camera</button>
        </div>

        <!-- Camera Container -->
        <div id="cameraFeedContainer" class="camera-feed-box hidden" style="margin: 0 auto; max-width: 640px;">
            <img id="cameraFeed" src="" alt="Camera Stream" style="width: 100%; border-radius: var(--radius-sm);">
        </div>

        <div class="mt-4">
            <button type="button" class="btn-outline" data-bs-toggle="modal" data-bs-target="#reviewModal">
                Leave a Review
            </button>
        </div>
    </div>
</main>

<!-- Modal for Review -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content"
            style="background: var(--bg-dark); border: 1px solid var(--glass-border); color: var(--text-main);">
            <div class="modal-header" style="border-bottom: 1px solid var(--glass-border);">
                <h5 class="modal-title" id="reviewModalLabel">Leave a Review</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <iframe src="{{ url_for('feed') }}" width="100%" height="400" frameborder="0"></iframe>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const startCameraButton = document.getElementById('startCameraButton');
    const closeCameraButton = document.getElementById('closeCameraButton');
    const cameraFeed = document.getElementById('cameraFeed');
    const cameraFeedContainer = document.getElementById('cameraFeedContainer');

    startCameraButton.addEventListener('click', () => {
        // Remove the hidden class so the container becomes visible
        cameraFeedContainer.classList.remove('hidden');
        cameraFeedContainer.style.display = 'flex'; // Ensure flex layout is applied

        // Start the camera feed
        cameraFeed.src = "{{ url_for('video_feed') }}";

        // Show the "Close Camera" button
        closeCameraButton.classList.remove('hidden');
        closeCameraButton.style.display = 'inline-block';

        // Hide the "Start Camera" button
        startCameraButton.style.display = 'none';
    });

    closeCameraButton.addEventListener('click', () => {
        // Hide the camera feed container
        cameraFeedContainer.classList.add('hidden');
        cameraFeedContainer.style.display = 'none';

        // Stop the camera feed by clearing the src
        cameraFeed.src = '';

        // Hide the "Close Camera" button
        closeCameraButton.classList.add('hidden');
        closeCameraButton.style.display = 'none';

        // Show the "Start Camera" button
        startCameraButton.style.display = 'inline-block';
    });
</script>
{% endblock %}